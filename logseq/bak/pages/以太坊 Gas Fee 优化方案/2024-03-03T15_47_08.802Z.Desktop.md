- ç°çŠ¶
	- ä¸ºäº†ç»´æŒäº¤æ˜“æ‰“åŒ…é€Ÿåº¦ï¼Œå½“å‰é…ç½®çš„äº¤æ˜“æ‰‹ç»­è´¹ gas price æ˜¯ 1.5å€ï¼Œå½“ç½‘ç»œæ‹¥å µæ—¶ï¼Œä¼šè¾¾åˆ°200-300 Gwei çš„æ‰‹ç»­è´¹
	- Gas Fee æ¯æœˆå¹³å‡ 5.8 ETHï¼Œçº¦ç­‰äº $11660
	- ![image.png](../assets/image_1683616960836_0.png){:height 403, :width 747}
- ç›®æ ‡
	- åœ¨ä¸é™ä½äº¤æ˜“æ‰“åŒ…é€Ÿåº¦çš„æƒ…å†µä¸‹ï¼Œå‡å°‘ Gas Feeï¼Œé¢„è®¡èŠ‚çœ 50% gas fee
	- å‡å°‘çš„ gas fee å¯ä»¥è®©åˆ©ç»™ç”¨æˆ·
- æ–¹æ¡ˆ
	- ä¿®æ”¹äº¤æ˜“æ‰‹ç»­è´¹å‚æ•°ï¼Œä»å›ºå®šå€æ•° Gas Price æ”¹ä¸º ERC-1559 çº¦å®šçš„ `priority_fee` å’Œ `max_fee`ï¼Œå‡å°‘æ¯æ¬¡äº¤æ˜“çš„ Gas Price
	- ä½¿ç”¨ #[[EIP-2930: Optional access lists]] ç‰¹æ€§ï¼Œå‡å°‘ Gas Used
- ä»¥å¤ªåŠäº¤æ˜“ gas fee æ¨¡å‹
	- äº¤æ˜“
		- åœ¨ä»¥å¤ªåŠä¸­ï¼Œç”¨æˆ·é€šè¿‡**äº¤æ˜“ Transaction** å’ŒåŒºå—é“¾äº¤äº’ã€‚äº¤æ˜“å¯ä»¥æ˜¯ä»ä¸€ä¸ªè´¦æˆ·è½¬ç§» ETH åˆ°å¦ä¸€ä¸ªè´¦æˆ·ï¼Œä¹Ÿå¯ä»¥æ˜¯æ‰§è¡Œæ›´åŠ å¤æ‚çš„åˆçº¦è°ƒç”¨ã€‚å› æ­¤ï¼Œç”¨ Gas æ¥è¡¡é‡æ‰§è¡Œæ¯ä¸ªäº¤æ˜“åœ¨æ‰§è¡Œæ—¶æ‰€éœ€è¦çš„èµ„æº
		- ä¸è®ºæ˜¯ç®€å•çš„äº¤æ˜“ï¼Œè¿˜æ˜¯å¤æ‚çš„åˆçº¦è°ƒç”¨ï¼Œäº¤æ˜“éƒ½å¯ä»¥æ‹†è§£ä¸ºæœ€åŸºæœ¬çš„æ“ä½œï¼Œæ¯ä¸ªåŸºæœ¬æ“ä½œå« **opcode æ“ä½œç **ï¼ˆå¯ä»¥ç†è§£ä¸ºæ±‡ç¼–çš„æŒ‡ä»¤ç ï¼‰ï¼Œæ¯ä¸ªæ“ä½œç éƒ½ä¼šå¯¹åº”ä¸€ä¸ª Gas æ¶ˆè€—ã€‚å…·ä½“æ“ä½œç å¯¹åº”çš„æˆæœ¬å¯å‚è€ƒï¼šhttps://www.evm.codes/
			- | Transaction operations | Gas |
			  | ADD | 3|
			  | SSTORE | 200 |
		- å› ä¸ºäº¤æ˜“æœ€ç»ˆæ˜¯åœ¨èŠ‚ç‚¹ï¼ˆæ¡†æ¶ï¼‰ä¸­æ‰§è¡Œå’Œæ‰“åŒ…åˆ° **block**çš„ï¼ŒèŠ‚ç‚¹æœºå™¨çš„è¿è¡Œæ—¶é—´å°±æ˜¯ç¨€ç¼ºèµ„æºï¼Œç”¨æˆ·éœ€è¦åœ¨å¹¿æ’­äº¤æ˜“æ—¶ï¼Œè¡¨æ˜è‡ªå·±æ„¿æ„æ”¯ä»˜å¤šå°‘ gas feeã€‚
			- | Transaction gas | Gas price (Gwei) | Total fee (Gwei) |
			  | ---- | ---- | ---- |
			  | 120 | 6 | 720 |
	- äº¤æ˜“è´¹ç”¨
		- ä»¥å¤ªåŠä¹‹å‰é‡‡ç”¨ ***First Price* Action** ï¼ˆé¦–ä»·æ‹å–ï¼‰çš„æ–¹å¼ç¡®å®šå“ªäº›äº¤æ˜“æ‰“åŒ…çš„åŒºå—
			- | Transaction gas | Gas price (Gwei) | Total fee (Gwei) | Included? | Cumulative gas |
			  | ---- | ---- | ---- |
			  | 120 | 6 | 720 | Yes | 120 |
			  | 200 | 5 | 1000 | Yes | 320 |
			  | 700 | 1 | 700 | No | 320 |
			- ç¼ºé™·ï¼š
				- é«˜ç«æ ‡è´¹ç”¨ï¼š
					- ç”±äºå‚ä¸è€…æƒ³è¦ç¡®ä¿è‡ªå·±èµ¢å¾—æ‹å–ï¼Œä»–ä»¬ä¼šæäº¤æ›´é«˜çš„ç«æ ‡ä»·æ ¼ã€‚è¿™ä¼šå¯¼è‡´ç«æ ‡è´¹ç”¨ä¸æ–­ä¸Šæ¶¨ï¼Œä½¿å¾—äº¤æ˜“å˜å¾—æ›´åŠ æ˜‚è´µã€‚
				- ä¸å¯é¢„æµ‹ï¼š
					- åœ¨ â€œfirst-price auctionâ€ ä¸­ï¼Œå‚ä¸è€…éœ€è¦ç¡®å®šä¸€ä¸ªæ°å½“çš„ç«æ ‡ä»·æ ¼ï¼Œè¿™å–å†³äºä»–ä»¬å¯¹å¸‚åœºä»·å€¼çš„é¢„æµ‹ã€‚è¿™ä¼šå¯¼è‡´å‚ä¸è€…é‡‡å–å„ç§ç­–ç•¥ï¼Œä¾‹å¦‚é€šè¿‡ä½ä¼°å¸‚åœºä»·å€¼æ¥èµ¢å¾—æ‹å–ï¼Œä»è€Œå¯¼è‡´æ‹å–ç»“æœçš„ä¸ç¡®å®šæ€§ã€‚
				- è™šå‡äº¤æ˜“ï¼š
					- ç”±äºä»¥å¤ªåŠæ˜¯ä¸€ä¸ªå¼€æ”¾çš„å¹³å°ï¼Œä»»ä½•äººéƒ½å¯ä»¥å‚ä¸ç«æ ‡ã€‚è¿™æ„å‘³ç€æ¶æ„å‚ä¸è€…å¯ä»¥é€šè¿‡è™šå‡äº¤æ˜“æˆ–å…¶ä»–æ‰‹æ®µæ¥å½±å“æ‹å–ç»“æœã€‚
				- ä¸å…¬å¹³æ€§ï¼š
					- å¯¹äºèµ„é‡‘è¾ƒå°‘çš„å‚ä¸è€…æ¥è¯´ï¼Œä»–ä»¬å¯èƒ½æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºæ¥å‚ä¸ç«æ ‡ï¼Œæˆ–è€…åªèƒ½ä»¥é«˜æ˜‚çš„ä»·æ ¼èµ¢å¾—æ‹å–ã€‚è¿™ä¼šå¯¼è‡´å¸‚åœºä¸Šå¯Œäººæ›´å¯Œï¼Œç©·äººæ›´ç©·çš„æƒ…å†µã€‚
			- æ›¿ä»£æ–¹æ¡ˆï¼š***Second-price* auctions**
		- EIP-1559ï¼šå¯¹ä»¥å¤ªåŠè´¹ç”¨å¸‚åœºçš„å‡çº§ã€‚è¯¥ææ¡ˆæå‡ç”¨æˆ·ä½“éªŒã€ç»æµå’Œå®‰å…¨ä¼˜åŠ¿
			- ç›®æ ‡ï¼š
			  collapsed:: true
				- ä½¿äº¤æ˜“è´¹å¯é¢„æµ‹
				- å‡å°‘äº¤æ˜“çš„å»¶è¿Ÿ
				- é€šè¿‡è‡ªåŠ¨åŒ–è´¹ç”¨ç«ä»·ç³»ç»Ÿæ”¹å–„ç”¨æˆ·ä½“éªŒ
				- åœ¨ç½‘ç»œæ´»åŠ¨å’ŒETHä¾›åº”ä¹‹é—´å»ºç«‹æ­£åé¦ˆå¾ªç¯
			- å®ç°ï¼š
				- base fee + tip fee
				- baseFeeï¼šè¡¨ç¤ºæ‰“åŒ…äº¤æ˜“åˆ°åŒºå—æ—¶ï¼Œæ‰€éœ€çš„æœ€å°  Gas priceï¼Œæ¯ä¸ªåŒºå—ä¼šæ ¹æ®åŒºå—å¤§å°ï¼ˆgas æ¶ˆè€—ï¼‰åŠ¨æ€è°ƒæ•´ã€‚
				  collapsed:: true
					- ä¸ºäº†é¿å…çŸ¿å·¥ä¸ºäº†è‡ªå·±çš„åˆ©ç›Šä¸²é€šå’Œäººä¸ºåœ°å¤¸å¤§åŸºæœ¬è´¹ç”¨çš„æƒ…å†µï¼Œæ•´ä¸ªåŸºæœ¬è´¹ç”¨éƒ½è¢«çƒ§æ¯ï¼ŒçŸ¿å·¥åªä¼šæ”¶å–å°è´¹
					- [Ethereum Blocks #17172664 | Etherscan](https://etherscan.io/block/17172664)
				- ç½‘ç»œå®¹é‡ï¼š
					- ä»æœ€å¤§ 15M Gas Limit æé«˜åˆ° 30M Gas Limitï¼ŒåŒæ—¶åŒºå—å¤§å°ä¹Ÿå¢åŠ ä¸€å€
						- [Ethereum Blocks #12965000 | Etherscan](https://etherscan.io/block/12965000)
						- ![image.png](../assets/image_1683028457731_0.png)
					- baseFee ä¼šéšç€ Gas Used ä½¿ç”¨æ¯”ä¾‹è¿›è¡Œè°ƒæ•´ï¼š
						- å¦‚æœ Gas Used > 50%ï¼ŒbaseFee ä¸Šå‡
						- å¦‚æœ Gas Used < 50%ï¼ŒbaseFee ä¸‹é™
						- ![](https://finematics.com/wp-content/uploads/2020/11/eip-smoothing-1024x459.png)
				- maxFeePerGasï¼šç”¨æˆ·æ„¿æ„æ”¯ä»˜çš„æœ€é«˜è´¹ç”¨
				- maxPriorityFeePerï¼šç”¨æˆ·æ„¿æ„æ”¯ä»˜çš„ä¼˜å…ˆçº§è´¹ç”¨ï¼ˆtip feeï¼‰
				- maxFeePerGas = ***baseFee*** + maxPriorityFeePer
			- å½±å“ï¼š
				- çŸ¿å·¥æ”¶ç›Šå‡å°‘
				  collapsed:: true
					- çŸ¿å·¥æ”¶ç›Šåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šåŒºå—å¥–åŠ± + Gas feeã€‚åœ¨é¦–ä»·æ‹å–çš„æœºåˆ¶ä¸‹ï¼ŒçŸ¿å·¥å¯ä»¥æ‹¿åˆ°æ‰€æœ‰çš„ Gas feeï¼Œè€Œåœ¨ 1159 æœºåˆ¶ä¸‹ï¼ŒçŸ¿å·¥åªèƒ½æ‹¿åˆ°åŒºå—å¥–åŠ±å’Œ tip fee
				- ç”¨æˆ·ä½“éªŒ
				  collapsed:: true
					- é’±åŒ…æ— éœ€æµ‹ç®— gas feeï¼Œåªéœ€è¦æ ¹æ®ä¸Šä¸€ä¸ªåŒºå—è®¾ç½® base feeï¼Œå†åŠ ä¸Š tip fee å³å¯ã€
				- ç½‘ç»œä½¿ç”¨æƒ…å†µå’ŒETHä¾›åº”ä¹‹é—´å»ºç«‹åé¦ˆå¾ªç¯
					- ğŸ›œç½‘ç»œæ‹¥å µ > ğŸ”¥ç‡ƒçƒ§æ›´å¤š ETH  > ğŸ“ˆETH ä»·æ ¼ä¸Šå‡ > å‡å°‘äº¤æ˜“æäº¤ > ç½‘ç»œæ‹¥å µç¼“è§£
	- äº¤æ˜“ç»“æ„
		- åœ¨EIP-2818 ææ¡ˆä¸­ï¼Œç±»å‹åŒ–äº†äº¤æ˜“çš„æ¶ˆæ¯ç»“æ„
			- TransactionType || TransactionPayload
		- [0x00] Legacy transactions
			- æ ¼å¼ï¼š
			- id:: 645b30a6-629c-44c2-b62b-834ffec65687
			  ```
			  0x00 || rlp([nonce, gasPrice, gasLimit, to, value, data, v, r, s])
			  ```
				- > ä»€ä¹ˆæ˜¯ #[[RLPï¼ˆRecursive Length Prefixï¼‰]] ï¼Ÿ
			- æ¡ˆä¾‹
				- [Ethereum Transaction Hash (Txhash) Details | Etherscan](https://etherscan.io/tx/0x1044d4735e6b32a0dfd843709a67d4fed7eb127acbc7fd4ae4098dbaf2426823)
				- ```json
				  /* 
				  0xf8cc82032e85102a74fea2834c4b4094bc4ca0eda7647a8ab7c2061c2e118a18a936f13d80b86423b872dd000000000000000000000000e2a83b15fc300d8457eb9e176f98d92a8ff40a49000000000000000000000000c67db0df922238979da0fd00d46016e8ae14cecb00000000000000000000000000000000000000000000000000000000000023451ba0e4b8eb77c3b2c83f179ab13e79e42e36770d65e1b1c9189492f5a965ccdc5c1fa030a5f73dd026f4f5dc7d2066c58618c6e3eadb5592b5181f66ef59bd9c088ff2
				  */
				  
				  {
				    blockNumber: 17141128,
				    blockHash: '0x72814f02f954bb86657a71cc48a4fe9614e4e41304b20c512d85ff47146582cd',
				    hash: '0x1044d4735e6b32a0dfd843709a67d4fed7eb127acbc7fd4ae4098dbaf2426823',
				    type: 0,
				    to: '0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D',
				    from: '0xe2A83b15FC300D8457eB9E176f98d92a8FF40a49',
				    nonce: 814,
				    gasLimit: 5000000n,
				    gasPrice: 69431787170n,
				    data: '0x23b872dd000000000000000000000000e2a83b15fc300d8457eb9e176f98d92a8ff40a49000000000000000000000000c67db0df922238979da0fd00d46016e8ae14cecb0000000000000000000000000000000000000000000000000000000000002345',
				    value: 0n,
				    signature: { r: "0xe4b8eb77c3b2c83f179ab13e79e42e36770d65e1b1c9189492f5a965ccdc5c1f", s: "0x30a5f73dd026f4f5dc7d2066c58618c6e3eadb5592b5181f66ef59bd9c088ff2", yParity: 0, networkV: null },
				  }
				  ```
		- [0x01] Access list transactions
			- #[[EIP-2930: Optional access lists]]
			- åœ¨äº¤æ˜“ä¸­æŒ‡å®šä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«äº†è®¡åˆ’è®¿é—®çš„**åœ°å€**å’Œ**å­˜å‚¨æ§½ä½**ï¼Œäº¤æ˜“åœ¨æ‰§è¡Œæ—¶åªèƒ½ä½¿ç”¨åˆ—è¡¨ä¸­æŒ‡å®šçš„åœ°å€å’Œå­˜å‚¨æ§½ä½ã€‚ä½¿ç”¨è¯¥ç±»å‹çš„äº¤æ˜“å¯ä»¥å¾—åˆ° 10% çš„ gas fee æŠ˜æ‰£ã€‚
			- æ ¼å¼
				- ```
				  0x01 || rlp([chainId, nonce, gasPrice, gasLimit, to, value, data, accessList, v, r, s])
				  ```
		- [0x02] Fee market change for ETH 1.0 chain
			- #[[EIP-1559 Fee market change for ETH 1.0 chain]]
			- [Ethereum Transaction Hash (Txhash) Details | Etherscan](https://etherscan.io/tx/0x69bb550be28f36921c111d36401fec39c871127dc68c44b6fcab147a34e346fa)
			- æ ¼å¼ï¼š
				- ```
				  0x02 || rlp([chain_id, nonce, max_priority_fee_per_gas, max_fee_per_gas, gas_limit, to, value, data, access_list, v, r, s])
				  ```
				-
- è®¿é—®åˆ—è¡¨(Access List)
	- åœ¨ Berlin ç¡¬åˆ†æ”¯ä¹‹åï¼ŒEVM æé«˜äº†æŸäº›opcode çš„ gas æ¶ˆè€—ã€‚
	- è®¿é—®æ¸…å•åŠŸèƒ½å¯ç•¥å¾®å‡å°‘ Gas å¼€é”€ï¼Œä½†æœ‰äº›æ—¶å€™ä¹Ÿå¯èƒ½ä¼šæé«˜æ€»çš„ Gas æ¶ˆè€—é‡
	- geth å®¢æˆ·ç«¯å¼•å…¥äº†ä¸€ç§æ–°çš„ RPC æ–¹æ³•ï¼Œå«åšÂ eth_createAccessListÂ æ¥ç®€åŒ–è®¿é—®æ¸…å•çš„ç”Ÿæˆ
		- ![image.png](../assets/image_1683700911634_0.png){:height 402, :width 716}
	- ```
	  
	  ======= è½¬ç§» 1 ä¸ª token ========
	  æ™®é€šäº¤æ˜“ gas æ¶ˆè€—:[0x1b8c7b239d31b97e8011d19156d1709ecf67f6513b2776461f0d33edbeecea33]109221
	  Access Listäº¤æ˜“ gas æ¶ˆè€—:[0xc395d7fa77c04992edc11de5e85d97384af6a6d06e9a29a299759133384a19fc]97666
	  èŠ‚çœGas Fee: 11555 10.579467318555956 %
	  
	  ======= è½¬ç§» 5 ä¸ª  token ========
	  æ™®é€šäº¤æ˜“ gas æ¶ˆè€—:[0xac27d7b474c1f410722acddefec5da2671f9f155d15351bb656207c27a5ff7ba]290823
	  Access Listäº¤æ˜“ gas æ¶ˆè€—:[0x1e2074ac2c6535bccb8591d23951bc4243fe880aa7be60b6900a586711668a29]287678
	  èŠ‚çœGas Fee: 3145 1.0814137808907824 %
	  
	  ======= è½¬ç§» 10 ä¸ª  token ========
	  æ™®é€šäº¤æ˜“ gas æ¶ˆè€—:[0xc6594500a758aaa593f5453b3272832ce0e78e2416d39d1ef922d4e42f2463d1]542978
	  Access Listäº¤æ˜“ gas æ¶ˆè€—:[0xc950ab908f1b0c0dcbe9ee02064ab6f49a854456d20ac69d0aa1de829338f489]497543
	  èŠ‚çœGas Fee: 45435 8.367742339468634 %
	  
	  
	  ===== ä¼ªä»£ç  ======
	  let gasEstimation = estimateGas(tx)
	  let { accessList, gasUsed } = createAccessList(tx)
	  if (gasUsed > gasEstimation) {
	    delete accessList[tx.to]
	  }
	  tx.accessList = accessList;
	  sendTransaction(tx)
	  ```
- æµ‹è¯•æ–¹æ³•å’ŒæŒ‡æ ‡
	- ERC-1559
		- 1559 æ–¹æ¡ˆåªå½±å“ Gas Priceï¼Œæ‰€ä»¥å¯ä»¥éšä¾¿æ‰¾ä¸€ç¬”æç°äº¤æ˜“ï¼ŒåŒæ—¶å‘èµ·å›ºå®š price å’Œ 1559 price ä¸¤ç±»äº¤æ˜“ã€‚
		- å¯¹æ¯”æ‰“åŒ…æ—¶é—´æ˜¯å¦æœ‰å·®å¼‚
		- å¯¹æ¯” gas fee èŠ‚çœé‡
	- EIP-2930
		- æ‰“åŒ…ç›¸åŒ collection çš„1ã€5ã€10 ä¸ªæç°äº¤æ˜“ï¼Œåˆ†åˆ«å¯¹æ¯” gas used
		- æ‰“åŒ…ä¸åŒ collection çš„ 1ã€5ã€10ä¸ªæç°äº¤æ˜“ï¼Œåˆ†åˆ«å¯¹æ¯” gas used
- å‚è€ƒæ–‡æ¡£
	- [Transaction types - Infura Docs](https://docs.infura.io/infura/networks/ethereum/concepts/transaction-types)
	- [EIP-1559 Resources ğŸ”¥ - HackMD](https://hackmd.io/@timbeiko/1559-resources)
	- [ETHä¼šå˜å¾—é€šè´§ç´§ç¼©å—ï¼ŸEIP-1559 è§£é‡Š â€“ ç²¾ç»†å­¦ (finematics.com)](https://finematics.com/ethereum-eip-1559-explained/)
	- [Understanding gas costs after Berlin - HackMD](https://hackmd.io/@fvictorio/gas-costs-after-berlin)
	- [EIP-2930 - Ethereum access list saving gas on cross-contract (rareskills.io)](https://www.rareskills.io/post/eip-2930-optional-access-list-ethereum)