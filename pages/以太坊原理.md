# ä»¥å¤ªåŠæ¶æ„
	- ## åŸºç¡€æ•°æ®ç»“æ„
		- ### åŸºç¡€é…ç½®
			- ChainIDï¼šEIP155 ä¸­å®ç°ï¼Œç”¨äºé˜²æ­¢é‡æ”¾æ”»å‡»
			- HomesteadBlockï¼šç¡¬åˆ†å‰é«˜åº¦
			- DAOForkBlockï¼šTHE DAO æ”»å‡»çš„è½¯åˆ†å‰ï¼Œç”¨äºé”å®š DAO çš„èµ„äº§è½¬ç§»
			- EIP150Block &EIP150Hashï¼šç”¨äºè§£å†³æ‹’ç»æœåŠ¡æ”»å‡»ï¼Œåœ¨æ¯ä¸ªæ–°åŒºå—ä¸­ä¼šæ¸…é™¤ä¸Šä¸€ä¸ªåŒºå—çš„çŠ¶æ€ç¼“å­˜
			- ByzantiumBlockï¼š[[ä»¥å¤ªåŠå‡çº§]]
		- ### è´¦æˆ·
			- EOA
			- åˆçº¦è´¦æˆ·ï¼š
				- ç”Ÿæˆç®—æ³•
					- CREATEï¼š`Keccak256(rlp([sender,nonce])[12:]`
					- CREATE2ï¼š`keccak256( 0xff ++ address ++ salt ++ keccak256(init_code))[12:]`
			- æ•°æ®ç»“æ„ï¼š`Nonce` `Balance` `StateRootHash` `CodeHash`
				- ![image.png](../assets/image_1709093166642_0.png){:height 388, :width 302}
			-
		- ### äº¤æ˜“
			- äº¤æ˜“ç¼–ç ä»¥ EIP-2718 ææ¡ˆä¸ºå‡†ï¼Œç›®å‰å…±æœ‰4ç§
				- ```
				  0x00 || rlp([nonce, gasPrice, gasLimit, to, value, data, v, r, s])
				  0x01 || rlp([chain_id, nonce, max_priority_fee_per_gas, max_fee_per_gas, gas_limit, to, value, data, access_list, v, r, s])
				  0x02 || rlp([chain_id, nonce, max_priority_fee_per_gas, max_fee_per_gas, gas_limit, to, value, data, access_list, v, r, s])
				  ```
		- ### åŒºå—
			- parentHash: ä¸Šä¸€ä¸ªåŒºå—çš„ hash
			- sha3Uncles: å”å—é›†åˆçš„ RLP hash
			- miner
			- stateRootï¼šä¸–ç•ŒçŠ¶æ€æ ‘æ ¹ï¼Œç”±æ‰€æœ‰è´¦æˆ·çŠ¶æ€ï¼ˆAccount Stateï¼‰æŒ‰ #é»˜å…‹å°”å‰ç¼€æ ‘ç®—æ³• ç”Ÿæˆ
			- transactionsRootï¼š è¯¥åŒºå—æ‰€åŒ…å«çš„æ‰€æœ‰äº¤æ˜“çš„æ ‘æ ¹
			- receiptRootï¼šäº¤æ˜“å›æ‰§çš„æ ‘æ ¹
			- logsBloomï¼šç”¨äºå¿«é€Ÿå®šä½åˆçº¦äº‹ä»¶
			- difficultyï¼šæŒ–çŸ¿éš¾åº¦
			- numberï¼šåŒºå—åºå·
			- gasLimitã€gasUsed
			- timestamp
			- extraDataï¼šçŸ¿å·¥è‡ªå®šä¹‰å­—æ®µï¼Œä¸€èˆ¬æ˜¯çŸ¿å·¥ç½‘å€
			- nonceï¼šPoW çš„å·¥ä½œé‡è¯æ˜ï¼Œä»¥å¤ªåŠå‡çº§ä¸º Pos ä¹‹ååºŸå¼ƒ
		- ### äº¤æ˜“å›æ‰§
			- å…±è¯†ä¿¡æ¯
				- `statue`ï¼š1 æˆåŠŸ 0 å¤±è´¥
				- `cumulativeGasUsed`ï¼šç´¯ç§¯æ¶ˆè€—çš„ Gas
				- `logs`ï¼šå½“å‰äº¤æ˜“æ‰§è¡Œæ‰€äº§ç”Ÿçš„åˆçº¦äº‹ä»¶åˆ—è¡¨
				- `bloom`ï¼šäº‹ä»¶#å¸ƒéš†è¿‡æ»¤å™¨ ï¼Œç”¨äºå¿«é€Ÿå®šä½æŸ topic æ˜¯å¦å­˜åœ¨äº logsä¸­
			- äº¤æ˜“ä¿¡æ¯
				- `txHash` `contractAddress` `gasUsed`
			- åŒºå—ä¿¡æ¯
				- `blockHash` `blockNumber` `transactionIndex`
		- ### Gas
			- [[ä»¥å¤ªåŠ Gas Fee ä¼˜åŒ–æ–¹æ¡ˆ]]
	- ## æ ¸å¿ƒæŠ€æœ¯
		- ### ç­¾åå’Œæ ¡éªŒ
			- ç­¾åç®—æ³•ï¼š`secp256k1`
			- ç­¾åè¿‡ç¨‹ï¼š
				- ```go
				  func main()  {  
				      dataHash := sha256.Sum256([]byte("ethereum"))
				  
				  	// å‡†å¤‡ç§é’¥
				  	pkeyb,err :=hex.DecodeString("289c2857d4598e37fb9647507e47a309d6133539bf21a8b9cb6df88fd5232032")
				  	if err!=nil{
				  		log.Fatalln(err)
				  	}
				  	// åŸºäºsecp256k1çš„ç§é’¥
				  	pkey,err:=crypto.ToECDSA(pkeyb)
				  	if err!=nil{
				  		log.Fatalln(err)
				  	}
				  	// ç­¾å
				  	sig,err:= crypto.Sign(dataHash[:],pkey)
				  	if err!=nil{
				  		log.Fatal(err)
				  	}
				  	fmt.Println("sig length:",len(sig))
				  	fmt.Println("sig hex:",hex.EncodeToString(sig))
				  }	
				  
				  //crypto/signature_nocgo.go:60
				  func Sign(hash []byte, prv *ecdsa.PrivateKey) ([]byte, error) {
				  	if len(hash) != 32 {
				  		return nil, fmt.Errorf("hash is required to be exactly 32 bytes (%d)", len(hash))
				  	}
				  	if prv.Curve != btcec.S256() {
				  		return nil, fmt.Errorf("private key curve is not secp256k1")
				  	}
				    
				  	sig, err := btcec.SignCompact(btcec.S256(), (*btcec.PrivateKey)(prv), hash, false)
				  	if err != nil {
				  		return nil, err
				  	}
				  	// Convert to Ethereum signature format with 'recovery id' v at the end.
				  	v := sig[0] - 27
				  	copy(sig, sig[1:])
				  	sig[64] = v
				  	return sig, nil
				  }
				  ```
			- ç­¾åæ ¡éªŒ
				- EIP155 ä¸­ v = recid + chainID* 2 +35
				- æ—§ç®—æ³•æ˜¯ v = recid + 27
		- ### é»˜å…‹å°”å‹ç¼©å‰ç¼€æ ‘ MPT
			-
			-
- # Solidity â†’ å­—èŠ‚ç  â†’ æ“ä½œç 
  collapsed:: true
	- EVM æ“ä½œç å ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œ8bitï¼Œæ‰€ä»¥æœ‰256 ç§ä¸åŒçš„[æ“ä½œç ](https://ethervm.io/)ï¼Œç›®å‰åªä½¿ç”¨äº†140 ä¸ª
		- ![image.png](../assets/image_1709089873993_0.png){:height 218, :width 475}
	- ç¼–ç å‡½æ•°
		- abi.encode (...) returns (bytes)ï¼šè®¡ç®—å‚æ•°çš„ ABI ç¼–ç ã€‚æ¯ä¸ªå‚æ•°ä¹‹å‰åŒ…å«ä¸€ä¸ª4å­—èŠ‚çš„é•¿åº¦å‰ç¼€
		- abi.encodePacked (...) returns (bytes)ï¼šè®¡ç®—å‚æ•°çš„ç´§å¯†æ‰“åŒ…ç¼–ç ï¼Œå‚æ•°è¿ç»­æ”¾ç½®ï¼Œå¯èƒ½å¯¼è‡´å“ˆå¸Œç¢°æ’ğŸ’¥
		- abi. encodeWithSelector (bytes4 selector, ...) returns (bytes)ï¼šè®¡ç®—å‡½æ•°é€‰æ‹©å™¨å’Œå‚æ•°çš„ ABI ç¼–ç ã€‚
		- abi.encodeWithSignature (string signature, ...) returns (bytes)ï¼šç­‰ä»·äº abi.encodeWithSelector (bytes4 (keccak256 (signature), ...)ã€‚
		- abi.encodeCall (function functionPointer, (...)) returns (bytes memory)ï¼šä½¿ç”¨ tuple ç±»å‹å‚æ•° ABI ç¼–ç è°ƒç”¨ functionPointer ()ã€‚æ‰§è¡Œå®Œæ•´çš„ç±»å‹æ£€æŸ¥ï¼Œç¡®ä¿ç±»å‹åŒ¹é…å‡½æ•°ç­¾åã€‚ç»“æœå’Œ abi.encodeWithSelector (functionPointer.selector, (...)) ä¸€è‡´ã€‚
- # å†…å­˜
	- TODO [æ·±å…¥ Solidity æ•°æ®å­˜å‚¨ä½ç½® | ç™»é“¾ç¤¾åŒº | åŒºå—é“¾æŠ€æœ¯ç¤¾åŒº (learnblockchain.cn)](https://learnblockchain.cn/article/4864#calldata%E5%BC%95%E7%94%A8)
	- å†…å­˜æ•°æ®ç»“æ„ï¼š
		- åˆçº¦ä¸­å¯ä»¥å­˜å‚¨32byte æˆ– 1byte çš„æ•°æ®å—ï¼Œæ¯æ¬¡åªèƒ½è¯»å–å›ºå®šå¤§å°ï¼ˆ32 æˆ–1ï¼‰çš„æ•°æ®å—
			- ![image.png](../assets/image_1708666221119_0.png){:height 606, :width 894}
			- æ“ä½œå†…å­˜çš„æ“ä½œç æœ‰ï¼š
				- MSTORE(x,y): ä»å†…å­˜X å¼€å§‹ï¼Œå­˜å‚¨ä¸€ä¸ª 32 byte çš„yå€¼
				- MLOAD(x)ï¼šä»å†…å­˜ä½ç½® x å¼€å§‹ï¼ŒåŠ è½½ä¸€ä¸ª 32 byte çš„å€¼åˆ°è°ƒç”¨æ ˆ
				- MSTORE8(x,y)ï¼šä»å†…å­˜x å¼€å§‹ï¼Œå­˜å‚¨ä¸€ä¸ª 1 byte çš„ y å€¼
		- ç©ºé—²å†…å­˜æŒ‡é’ˆ
			- æŒ‡å‘ä¸€ä¸ªç©ºé—²å†…å­˜å¼€å§‹çš„ä½ç½®ï¼Œç¡®ä¿æ™ºèƒ½åˆçº¦å¯ä»¥è¿½è¸ªå†…å­˜ä½ç½®æ˜¯å¦å†™å…¥ï¼Œé˜²æ­¢è¦†ç›–å˜é‡ã€‚
				- `å†…å­˜æŒ‡é’ˆçš„ä½ç½® + æ•°æ®å­—èŠ‚å¤§å° = æ–°ç©ºé—²å†…å­˜æŒ‡é’ˆçš„ä½ç½®`
				- å†…å­˜å¸ƒå±€ä¿ç•™çš„æ’æ§½
					- **0x00**ï¼šæš‚å­˜ç©ºé—´ï¼Œ
					- **0x40**ï¼šç©ºé—²å†…å­˜æŒ‡é’ˆï¼Œç¬¬ä¸€ä¸ªå¯ä»¥ç”¨äºå­˜å‚¨çš„ä½ç½®ï¼Œä¼šåˆå§‹åŒ–ä¸º 0x80
			-
	-
-
-